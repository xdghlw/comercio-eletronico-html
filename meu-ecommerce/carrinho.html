<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Carrinho</title>
    <link rel="stylesheet" href="/meu-ecommerce/css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
</head>

<body>
    <header>
        <nav class="navbar navbar-expand-lg bg-primary" data-bs-theme="">
            <div id="index-container-fluid" class="container-fluid">
                <div class="dropdown">
                    <button class="btn btn-primary dropdown-toggle bg-primary border-light" type="button"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-person-fill"></i>
                    </button>
                    <ul id="cabecalho" class="dropdown-menu">
                        <!-- items cabecalho -->
                    </ul>
                </div>
                <button class="navbar-toggler navbar-toggler-sm bg-white border-light" type="button"
                    data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
                    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto ms-2 mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link btn btn-primary" aria-current="page" href="produtos.html">Produtos
                                <small><i class="bi bi-bag mx-1"></i></small></a>
                        </li>
                    </ul>
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link btn btn-primary" aria-current="page" href="contato.html">Contato<small><i
                                        class="bi bi-chat-left-dots mx-1"></i></small></a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main class="min-vh-100">
        <hr>
        <div class="container align-self-center">
            <ul class="list-group mb-3">

            </ul>
            <div class="d-grid gap-2 col-6 mx-auto">
                <button class="btn btn-success mb-5 mt-5" type="button">Finalizar Compra</button>
            </div>
        </div>
        <script>
            function atualizarMenuAvatar() {
                const menu = document.getElementById("cabecalho");
                menu.innerHTML = "";
                const usuarioLogado = localStorage.getItem("usuarioLogado");
                if (!usuarioLogado) {
                    // Usuário NÃO logado
                    menu.innerHTML = `
                        <li>
                            <a class="dropdown-item" href="login.html">Entrar</a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="cadastro.html">Cadastrar</a>
                        </li>
                    `;
                } else {
                    // Usuário logado
                    menu.innerHTML = `
                        <li>
                            <a class="dropdown-item" href="meus_dados.html">Meus Dados</a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="meus_edidos.html">Meus Pedidos</a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item text-danger" href="#" onclick="finalizarSessao()">Sair</a>
                        </li>
                    `;
                }
            }
            function finalizarSessao() {
                localStorage.removeItem("usuarioLogado");
                window.location.href = "index.html";
            }

            function adicionarItemCarrinho(id, produto) {
                const lista = document.querySelector("ul.list-group.mb-3");
                if (!lista) return;

                const li = document.createElement("li");
                li.className =
                    "list-group-item py-3 d-flex justify-content-between align-items-center";

                li.innerHTML = `
        <div class="flex-grow-1">
            <div class="row g-3 p-3 mx-3">
                <div class="col-4 col-md-3 col-lg-2">
                    <a href="#">
                        <img src="${produto.image}" class="img-thumbnail" alt="${produto.name}">
                    </a>
                </div>

                <div class="col-8 col-md-9 col-lg-7 col-xl-8 align-self-center">
                    <h4 class="mb-1">
                        <b>
                            <a href="#" class="text-decoration-none text-danger">
                                ${produto.name}
                            </a>
                        </b>
                    </h4>

                    <p class="mb-1">
                        <small>${produto.description}</small>
                    </p>

                    <p class="mb-0">
                        <small>Preço: R$ ${produto.price.toFixed(2)}</small>
                    </p>

                    <p class="mb-0 qtd-text">
                        <small>Quantidade: ${produto.quantidade}</small>
                    </p>

                    <p class="mb-0 total-text">
                        <small>
                            Valor Total: R$ ${calcularPrecoTotal(produto.quantidade, produto.price).toFixed(2)}
                        </small>
                    </p>
                </div>
            </div>
        </div>

        <div class="input-group ms-3 me-3 col-md-8 col-lg-6" style="width: 120px;">
            <button type="button" class="btn btn-outline-dark btn-sm btn-up">
                <i class="bi bi-arrow-up"></i>
            </button>

            <input type="text"
                   class="form-control text-center border-dark"
                   value="${produto.quantidade}">

            <button type="button" class="btn btn-outline-dark btn-sm btn-down">
                <i class="bi bi-arrow-down"></i>
            </button>
        </div>

        <button type="button" class="btn btn-outline-danger btn-remove text-danger">
            <i class="bi bi-trash"></i>
        </button>
    `;

                const incrementar = li.querySelector(".btn-up");
                const decrementar = li.querySelector(".btn-down");
                const removerItem = li.querySelector(".btn-remove");
                const qtdeInput = li.querySelector("input");
                const qtdeTexto = li.querySelector(".qtd-text small");
                const valorTotal = li.querySelector(".total-text small");

                incrementar.addEventListener("click", () => {
                    produto.quantidade++;
                    atualizar();
                });

                decrementar.addEventListener("click", () => {
                    if (produto.quantidade > 1) {
                        produto.quantidade--;
                        atualizar();
                    }
                });

                removerItem.addEventListener("click", () => {
                    li.remove();
                    let carrinhoCompras = JSON.parse(localStorage.getItem("carrinho"));
                    delete carrinhoCompras[id];
                    localStorage.setItem("carrinho", JSON.stringify(carrinhoCompras));
                });

                function atualizar() {
                    let carrinhoCompras = JSON.parse(localStorage.getItem("carrinho"));
                    carrinhoCompras[id].quantidade = produto.quantidade;
                    localStorage.setItem("carrinho", JSON.stringify(carrinhoCompras));
                    qtdeInput.value = produto.quantidade;
                    qtdeTexto.textContent = `Quantidade: ${produto.quantidade}`;
                    valorTotal.textContent =
                        `Valor Total: R$ ${calcularPrecoTotal(produto.quantidade, produto.price).toFixed(2)}`;
                }

                lista.appendChild(li);
            }




            function calcularPrecoTotal(quantidade, preco) {
                return quantidade * preco;
            }
            atualizarMenuAvatar();
        </script>
        <script>
            Object.keys(JSON.parse(localStorage.getItem("carrinho"))).forEach(id => {
                adicionarItemCarrinho(id, JSON.parse(localStorage.getItem("carrinho"))[id]);
            });
        </script>
    </main>

    <footer class="">
        <div class="container-fluid border-top text-muted bg-light mt-5 position-sticky">
            <div class="row py-3">
                <div class="col-12 text-center text-md-left">
                    Loja Virtual 2025
                </div>
            </div>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>